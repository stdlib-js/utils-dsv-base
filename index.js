// Copyright (c) 2023 The Stdlib Authors. License is Apache-2.0: http://www.apache.org/licenses/LICENSE-2.0
var e,t;e=this,t=function(){"use strict";var e="function"==typeof Object.defineProperty?Object.defineProperty:null,t=Object.defineProperty;function i(e){return"number"==typeof e}function n(e){var t,i="";for(t=0;t<e;t++)i+="0";return i}function r(e,t,i){var r=!1,s=t-e.length;return s<0||(function(e){return"-"===e[0]}(e)&&(r=!0,e=e.substr(1)),e=i?e+n(s):n(s)+e,r&&(e="-"+e)),e}var s=String.prototype.toLowerCase,o=String.prototype.toUpperCase;function a(e){var t,n,a;switch(e.specifier){case"b":t=2;break;case"o":t=8;break;case"x":case"X":t=16;break;default:t=10}if(n=e.arg,a=parseInt(n,10),!isFinite(a)){if(!i(n))throw new Error("invalid integer. Value: "+n);a=0}return a<0&&("u"===e.specifier||10!==t)&&(a=4294967295+a+1),a<0?(n=(-a).toString(t),e.precision&&(n=r(n,e.precision,e.padRight)),n="-"+n):(n=a.toString(t),a||e.precision?e.precision&&(n=r(n,e.precision,e.padRight)):n="",e.sign&&(n=e.sign+n)),16===t&&(e.alternate&&(n="0x"+n),n=e.specifier===o.call(e.specifier)?o.call(n):s.call(n)),8===t&&e.alternate&&"0"!==n.charAt(0)&&(n="0"+n),n}function _(e){return"string"==typeof e}var c=Math.abs,u=String.prototype.toLowerCase,d=String.prototype.toUpperCase,p=String.prototype.replace,h=/e\+(\d)$/,l=/e-(\d)$/,f=/^(\d+)$/,g=/^(\d+)e/,m=/\.0$/,w=/\.0*e/,v=/(\..*[^0])0*e/;function k(e){var t,n,r=parseFloat(e.arg);if(!isFinite(r)){if(!i(e.arg))throw new Error("invalid floating-point number. Value: "+n);r=e.arg}switch(e.specifier){case"e":case"E":n=r.toExponential(e.precision);break;case"f":case"F":n=r.toFixed(e.precision);break;case"g":case"G":c(r)<1e-4?((t=e.precision)>0&&(t-=1),n=r.toExponential(t)):n=r.toPrecision(e.precision),e.alternate||(n=p.call(n,v,"$1e"),n=p.call(n,w,"e"),n=p.call(n,m,""));break;default:throw new Error("invalid double notation. Value: "+e.specifier)}return n=p.call(n,h,"e+0$1"),n=p.call(n,l,"e-0$1"),e.alternate&&(n=p.call(n,f,"$1."),n=p.call(n,g,"$1.e")),r>=0&&e.sign&&(n=e.sign+n),n=e.specifier===d.call(e.specifier)?d.call(n):u.call(n)}function b(e){var t,i="";for(t=0;t<e;t++)i+=" ";return i}function y(e,t,i){var n=t-e.length;return n<0?e:e=i?e+b(n):b(n)+e}var S=String.fromCharCode,x=isNaN,q=Array.isArray;function L(e){var t={};return t.specifier=e.specifier,t.precision=void 0===e.precision?1:e.precision,t.width=e.width,t.flags=e.flags||"",t.mapping=e.mapping,t}function E(e){var t,i,n,s,o,c,u,d,p;if(!q(e))throw new TypeError("invalid argument. First argument must be an array. Value: `"+e+"`.");for(c="",u=1,d=0;d<e.length;d++)if(_(n=e[d]))c+=n;else{if(t=void 0!==n.precision,!(n=L(n)).specifier)throw new TypeError("invalid argument. Token is missing `specifier` property. Index: `"+d+"`. Value: `"+n+"`.");for(n.mapping&&(u=n.mapping),i=n.flags,p=0;p<i.length;p++)switch(s=i.charAt(p)){case" ":n.sign=" ";break;case"+":n.sign="+";break;case"-":n.padRight=!0,n.padZeros=!1;break;case"0":n.padZeros=i.indexOf("-")<0;break;case"#":n.alternate=!0;break;default:throw new Error("invalid flag: "+s)}if("*"===n.width){if(n.width=parseInt(arguments[u],10),u+=1,x(n.width))throw new TypeError("the argument for * width at position "+u+" is not a number. Value: `"+n.width+"`.");n.width<0&&(n.padRight=!0,n.width=-n.width)}if(t&&"*"===n.precision){if(n.precision=parseInt(arguments[u],10),u+=1,x(n.precision))throw new TypeError("the argument for * precision at position "+u+" is not a number. Value: `"+n.precision+"`.");n.precision<0&&(n.precision=1,t=!1)}switch(n.arg=arguments[u],n.specifier){case"b":case"o":case"x":case"X":case"d":case"i":case"u":t&&(n.padZeros=!1),n.arg=a(n);break;case"s":n.maxWidth=t?n.precision:-1;break;case"c":if(!x(n.arg)){if((o=parseInt(n.arg,10))<0||o>127)throw new Error("invalid character code. Value: "+n.arg);n.arg=x(o)?String(n.arg):S(o)}break;case"e":case"E":case"f":case"F":case"g":case"G":t||(n.precision=6),n.arg=k(n);break;default:throw new Error("invalid specifier: "+n.specifier)}n.maxWidth>=0&&n.arg.length>n.maxWidth&&(n.arg=n.arg.substring(0,n.maxWidth)),n.padZeros?n.arg=r(n.arg,n.width||n.precision,n.padRight):n.width&&(n.arg=y(n.arg,n.width,n.padRight)),c+=n.arg||"",u+=1}return c}var I=/%(?:([1-9]\d*)\$)?([0 +\-#]*)(\*|\d+)?(?:(\.)(\*|\d+)?)?[hlL]?([%A-Za-z])/g;function C(e){var t={mapping:e[1]?parseInt(e[1],10):void 0,flags:e[2],width:e[3],precision:e[5],specifier:e[6]};return"."===e[4]&&void 0===e[5]&&(t.precision="1"),t}function R(e){var t,i,n,r;for(i=[],r=0,n=I.exec(e);n;)(t=e.slice(r,I.lastIndex-n[0].length)).length&&i.push(t),i.push(C(n)),r=I.lastIndex,n=I.exec(e);return(t=e.slice(r)).length&&i.push(t),i}function j(e){return"string"==typeof e}function O(e){var t,i,n;if(!j(e))throw new TypeError(O("invalid argument. First argument must be a string. Value: `%s`.",e));for(t=R(e),(i=new Array(arguments.length))[0]=t,n=1;n<i.length;n++)i[n]=arguments[n];return E.apply(null,i)}var W,N=Object.prototype,V=N.toString,A=N.__defineGetter__,P=N.__defineSetter__,D=N.__lookupGetter__,F=N.__lookupSetter__;W=function(){try{return e({},"x",{}),!0}catch(e){return!1}}()?t:function(e,t,i){var n,r,s,o;if("object"!=typeof e||null===e||"[object Array]"===V.call(e))throw new TypeError(O("invalid argument. First argument must be an object. Value: `%s`.",e));if("object"!=typeof i||null===i||"[object Array]"===V.call(i))throw new TypeError(O("invalid argument. Property descriptor must be an object. Value: `%s`.",i));if((r="value"in i)&&(D.call(e,t)||F.call(e,t)?(n=e.__proto__,e.__proto__=N,delete e[t],e[t]=i.value,e.__proto__=n):e[t]=i.value),s="get"in i,o="set"in i,r&&(s||o))throw new Error("invalid argument. Cannot specify one or more accessors and a value or writable attribute in the property descriptor.");return s&&A&&A.call(e,t,i.get),o&&P&&P.call(e,t,i.set),e};var T=W;function Q(e){if(e.__esModule)return e;var t=e.default;if("function"==typeof t){var i=function e(){if(this instanceof e){var i=[null];i.push.apply(i,arguments);var n=Function.bind.apply(t,i);return new n}return t.apply(this,arguments)};i.prototype=t.prototype}else i={};return Object.defineProperty(i,"__esModule",{value:!0}),Object.keys(e).forEach((function(t){var n=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(i,t,n.get?n:{enumerable:!0,get:function(){return e[t]}})})),i}var B,G=Q(Object.freeze({__proto__:null,default:()=>()=>{}})),$="function"==typeof Object.defineProperty?Object.defineProperty:null,U=Object.defineProperty,Z=Object.prototype,z=Z.toString,M=Z.__defineGetter__,X=Z.__defineSetter__,H=Z.__lookupGetter__,J=Z.__lookupSetter__;B=function(){try{return $({},"x",{}),!0}catch(e){return!1}}()?U:function(e,t,i){var n,r,s,o;if("object"!=typeof e||null===e||"[object Array]"===z.call(e))throw new TypeError(O("invalid argument. First argument must be an object. Value: `%s`.",e));if("object"!=typeof i||null===i||"[object Array]"===z.call(i))throw new TypeError(O("invalid argument. Property descriptor must be an object. Value: `%s`.",i));if((r="value"in i)&&(H.call(e,t)||J.call(e,t)?(n=e.__proto__,e.__proto__=Z,delete e[t],e[t]=i.value,e.__proto__=n):e[t]=i.value),s="get"in i,o="set"in i,r&&(s||o))throw new Error("invalid argument. Cannot specify one or more accessors and a value or writable attribute in the property descriptor.");return s&&M&&M.call(e,t,i.get),o&&X&&X.call(e,t,i.set),e};var K=B;function Y(e,t,i){K(e,t,{configurable:!1,enumerable:!1,writable:!1,value:i})}var ee,te="function"==typeof Object.defineProperty?Object.defineProperty:null,ie=Object.defineProperty,ne=Object.prototype,re=ne.toString,se=ne.__defineGetter__,oe=ne.__defineSetter__,ae=ne.__lookupGetter__,_e=ne.__lookupSetter__;ee=function(){try{return te({},"x",{}),!0}catch(e){return!1}}()?ie:function(e,t,i){var n,r,s,o;if("object"!=typeof e||null===e||"[object Array]"===re.call(e))throw new TypeError(O("invalid argument. First argument must be an object. Value: `%s`.",e));if("object"!=typeof i||null===i||"[object Array]"===re.call(i))throw new TypeError(O("invalid argument. Property descriptor must be an object. Value: `%s`.",i));if((r="value"in i)&&(ae.call(e,t)||_e.call(e,t)?(n=e.__proto__,e.__proto__=ne,delete e[t],e[t]=i.value,e.__proto__=n):e[t]=i.value),s="get"in i,o="set"in i,r&&(s||o))throw new Error("invalid argument. Cannot specify one or more accessors and a value or writable attribute in the property descriptor.");return s&&se&&se.call(e,t,i.get),o&&oe&&oe.call(e,t,i.set),e};var ce=ee,ue=Boolean;function de(e){return"string"==typeof e}var pe="function"==typeof Symbol&&"symbol"==typeof Symbol("foo");function he(){return pe&&"symbol"==typeof Symbol.toStringTag}var le=Object.prototype.toString,fe=Object.prototype.hasOwnProperty,ge="function"==typeof Symbol?Symbol:void 0,me="function"==typeof ge?ge.toStringTag:"",we=he()?function(e){var t,i,n,r,s;if(null==e)return le.call(e);i=e[me],s=me,t=null!=(r=e)&&fe.call(r,s);try{e[me]=void 0}catch(t){return le.call(e)}return n=le.call(e),t?e[me]=i:delete e[me],n}:function(e){return le.call(e)},ve=String.prototype.valueOf,ke=he();function be(e){return"object"==typeof e&&(e instanceof String||(ke?function(e){try{return ve.call(e),!0}catch(e){return!1}}(e):"[object String]"===we(e)))}function ye(e){return de(e)||be(e)}Y(ye,"isPrimitive",de),Y(ye,"isObject",be);var Se=/[-\/\\^$*+?.()|[\]{}]/g;function xe(e){var t,i;if(!de(e))throw new TypeError(O("invalid argument. Must provide a regular expression string. Value: `%s`.",e));if("/"===e[0])for(i=e.length-1;i>=0&&"/"!==e[i];i--);return void 0===i||i<=0?e.replace(Se,"\\$&"):(t=(t=e.substring(1,i)).replace(Se,"\\$&"),e=e[0]+t+e.substring(i))}function qe(e,t,i){return e.replace(t,i)}function Le(){}function Ee(e){throw e}function Ie(){return{comment:"",delimiter:",",doublequote:!0,escape:"",ltrim:!1,maxRows:1e308,newline:"\r\n",onClose:Le,onColumn:Le,onComment:null,onError:Ee,onRow:Le,onSkip:null,onWarn:null,quote:'"',quoting:!0,rowBuffer:[],rtrim:!1,skip:"",skipBlankRows:!1,skipRow:null,strict:!0,trimComment:!0,whitespace:[" "]}}var Ce=["closed","comment","escape","error","field","init","invalid_quote_end","quote_end","quoted_escape","quoted_field","skip","skipped_comment","skipped_escape","skipped_field","skipped_invalid_quote_end","skipped_quote_end","skipped_quoted_escape","skipped_quoted_field"],Re=function(){var e,t;for(e={},t=0;t<Ce.length;t++)e[Ce[t]]=t;return e}(),je=Re.closed,Oe=G("state:comment"),We=Re.init,Ne=Re.error;function Ve(e,t){return e<t?t:e}var Ae=G("state:escape"),Pe=Re.error,De=Re.field,Fe=G("state:field"),Te=Re.escape,Qe=Re.field,Be=Re.init,Ge=Re.quoted_field,$e=G("state:init"),Ue=Re.comment,Ze=Re.field,ze=Re.escape,Me=Re.init,Xe=Re.quoted_field,He=Re.skip,Je=G("state:invalid_quote_end"),Ke=Re.error,Ye=Re.field,et=Re.init;function tt(e,t){e._isWhitespace(e._qidx+1,e._cursor)?e._raiseWarning("INVALID_CLOSING_QUOTE")._rewind(e._cursor-e._qidx)._changeState(t):(Je("Error."),e._setErrorState("INVALID_CLOSING_QUOTE")._changeState(Ke))}var it=G("state:quote_end"),nt=Re.error,rt=Re.field,st=Re.init,ot=Re.invalid_quote_end,at=Re.quoted_field,_t=G("state:quoted_escape"),ct=Re.error,ut=Re.quoted_field,dt=G("state:quoted_field"),pt=Re.quote_end,ht=Re.quoted_escape,lt=G("state:skip"),ft=Re.init,gt=Re.skip,mt=Re.skipped_comment,wt=Re.skipped_field,vt=Re.skipped_escape,kt=Re.skipped_quoted_field,bt=G("state:skipped_comment"),yt=Re.init,St=G("state:skipped_escape"),xt=Re.skipped_field,qt=G("state:skipped_field"),Lt=Re.init,Et=Re.skipped_escape,It=Re.skipped_field,Ct=Re.skipped_quoted_field,Rt=G("state:skipped_invalid_quote_end"),jt=Re.skipped_field,Ot=Re.init,Wt=G("state:skipped_quote_end"),Nt=Re.init,Vt=Re.skipped_field,At=Re.skipped_invalid_quote_end,Pt=Re.skipped_quoted_field,Dt=G("state:skipped_quoted_escape"),Ft=Re.skipped_quoted_field,Tt=G("state:skipped_quoted_field"),Qt=Re.skipped_quote_end,Bt=Re.skipped_quoted_escape,Gt={closed:function(e){return function(){e._changeState(je)}},comment:function(e){var t,i;return t=e._newlineLastIndex,i=e._newline,function(n){if(Oe("Char: %s",n),n===i[t]&&e._scan(i,t))return Oe("Newline."),void e._rewind(t)._changeState(We);e._push(n)}},escape:function(e){var t,i,n,r,s,o,a,_,c,u,d,p,h;return t=e._delimiterLastIndex,a=e._delimiter,i=e._newlineLastIndex,_=e._newline,n=e._commentLastIndex,c=e._comment,s=e._skipLastIndex,p=e._skip,r=e._escapeLastIndex,o=e._escapeLength,u=e._escape,d=e._strict,h=Ve(Ve(t,i),r),function(l){var f=e._cursor,g=e._eidx,m=f-g;return Ae("Char: %s",l),m===t&&l===a[t]&&e._scan(a,t)?(Ae("Delimiter."),void e._copyWithin(g-r,g+1,t)._rewind(o)._push(l)._changeState(De)):m===i&&l===_[i]&&e._scan(_,i)?(Ae("Newline."),void e._copyWithin(g-r,g+1,i)._rewind(o)._push(l)._changeState(De)):m===r&&l===u[r]&&e._scan(u,r)?(Ae("Escape."),void e._copyWithin(g-r,g+1,r)._rewind(o)._push(l)._changeState(De)):c&&f-n==0&&l===c[n]&&e._scan(c,n)?(Ae("Comment."),void e._copyWithin(g-n,g+1,n)._rewind(o)._push(l)._changeState(De)):p&&f-s==0&&l===p[s]&&e._scan(p,s)?(Ae("Skip."),void e._copyWithin(g-s,g+1,s)._rewind(o)._push(l)._changeState(De)):m>=h?d?(Ae("Error."),void e._setErrorState("INVALID_ESCAPE")._changeState(Pe)):(Ae("Escape sequence is not followed by a special character sequence."),void e._raiseWarning("INVALID_ESCAPE")._push(l)._changeState(De)):void e._push(l)}},error:function(e){return function(){e._changeState(Ne)}},field:function(e){var t,i,n,r,s,o,a,_,c,u;return n=e._escapeLastIndex,_=e._escape,r=e._quoteLastIndex,u=e._quote,t=e._delimiterLastIndex,s=e._delimiter,i=e._newlineLastIndex,o=e._newline,a=e._quoting,c=e._strict,function(d){var p=e._cursor-e._cidx+1;return Fe("Char: %s",d),d===_[n]&&e._scan(_,n)?(Fe("Escape."),void e._push(d)._changeState(Te)):p-r==0&&d===u[r]&&e._scan(u,r)?a?(Fe("Quote."),void e._rewind(r)._changeState(Ge)):void e._push(d):!1===c&&d===u[r]&&e._scan(u,r)?a&&e._isWhitespace(e._cidx,e._cursor-r)?(Fe("Quote."),void e._raiseWarning("INVALID_OPENING_QUOTE")._rewind(p)._changeState(Ge)):void e._push(d):d===s[t]&&e._scan(s,t)?(Fe("Delimiter."),void e._rewind(t)._changeState(Qe)):d===o[i]&&e._scan(o,i)?(Fe("Newline."),void e._rewind(i)._changeState(Be)):void e._push(d)}},init:function(e){var t,i,n,r,s,o,a,_,c,u,d,p,h,l;return n=e._commentLastIndex,c=e._comment,o=e._skipLastIndex,l=e._skip,r=e._escapeLastIndex,d=e._escape,s=e._quoteLastIndex,h=e._quote,t=e._delimiterLastIndex,a=e._delimiter,i=e._newlineLastIndex,_=e._newline,u=e._quoting,p=e._strict,function(f){var g=e._cursor+1;return $e("Char: %s",f),c&&g-n==0&&f===c[n]&&e._scan(c,n)?($e("Comment."),void e._rewind(n)._changeState(Ue)):l&&g-o==0&&f===l[o]&&e._scan(l,o)?($e("Skip."),void e._rewind(o)._changeState(He)):f===d[r]&&e._scan(d,r)?($e("Escape."),void e._push(f)._changeState(ze)):g-s==0&&f===h[s]&&e._scan(h,s)?u?($e("Quote."),void e._rewind(s)._changeState(Xe)):void e._push(f):!1===p&&f===h[s]&&e._scan(h,s)?u&&e._isWhitespace(0,e._cursor-s)?($e("Quote."),void e._raiseWarning("INVALID_OPENING_QUOTE")._rewind(g)._changeState(Xe)):void e._push(f):f===a[t]&&e._scan(a,t)?($e("Delimiter."),void e._rewind(t)._changeState(Ze)):f===_[i]&&e._scan(_,i)?($e("Newline."),void e._rewind(i)._changeState(Me)):void e._push(f)}},invalid_quote_end:function(e){var t,i,n,r;return t=e._delimiterLastIndex,n=e._delimiter,i=e._newlineLastIndex,r=e._newline,function(s){return Je("Char: %s",s),s===n[t]&&e._scan(n,t)?(Je("Delimiter."),e._rewind(t),void tt(e,Ye)):s===r[i]&&e._scan(r,i)?(Je("Newline."),e._rewind(i),void tt(e,et)):void e._push(s)}},quote_end:function(e){var t,i,n,r,s,o,a,_,c;return t=e._delimiterLastIndex,s=e._delimiter,i=e._newlineLastIndex,o=e._newline,n=e._quoteLastIndex,_=e._quote,r=e._doublequote,a=e._strict,c=Ve(Ve(t,i),n),function(u){return it("Char: %s",u),r&&u===_[n]&&e._scan(_,n)?(it("Double quote."),void e._push(u)._changeState(at)):u===s[t]&&e._scan(s,t)?(it("Delimiter."),void e._rewind(t)._changeState(rt)):u===o[i]&&e._scan(o,i)?(it("Newline."),void e._rewind(i)._changeState(st)):e._cursor-e._qidx>=c?a?(it("Error."),void e._setErrorState("INVALID_CLOSING_QUOTE")._changeState(nt)):(it("Invalid closing quote."),void e._push(u)._changeState(ot)):void e._push(u)}},quoted_escape:function(e){var t,i,n,r,s;return i=e._quoteLastIndex,s=e._quote,t=e._escapeLastIndex,n=e._escapeLength,r=e._strict,function(o){var a=e._cursor,_=e._eidx,c=a-_;return _t("Char: %s",o),c===i&&o===s[i]&&e._scan(s,i)?(_t("Quote."),void e._copyWithin(_-t,_+1,i)._rewind(n)._push(o)._changeState(ut)):c>=i?r?(_t("Error."),void e._setErrorState("INVALID_QUOTED_ESCAPE")._changeState(ct)):(_t("Escape sequence is not followed by a quote sequence."),void e._raiseWarning("INVALID_QUOTED_ESCAPE")._push(o)._changeState(ut)):void e._push(o)}},quoted_field:function(e){var t,i,n,r,s;return t=e._escapeLastIndex,r=e._escape,i=e._quoteLastIndex,s=e._quote,n=e._doublequote,function(o){return dt("Char: %s",o),!1===n&&o===r[t]&&e._scan(r,t)?(dt("Escape."),void e._push(o)._changeState(ht)):o===s[i]&&e._scan(s,i)?(dt("Quote."),void e._rewind(i)._changeState(pt)):void e._push(o)}},skip:function(e){var t,i,n,r,s,o,a,_,c,u,d,p,h,l;return n=e._commentLastIndex,c=e._comment,o=e._skipLastIndex,l=e._skip,r=e._escapeLastIndex,d=e._escape,s=e._quoteLastIndex,h=e._quote,t=e._delimiterLastIndex,a=e._delimiter,i=e._newlineLastIndex,_=e._newline,u=e._quoting,p=e._strict,function(f){var g=e._cursor+1;return lt("Char: %s",f),c&&g-n==0&&f===c[n]&&e._scan(c,n)?(lt("Comment."),void e._push(f)._changeState(mt)):l&&g-o==0&&f===l[o]&&e._scan(l,o)?(lt("Skip."),void e._push(f)._changeState(gt)):f===d[r]&&e._scan(d,r)?(lt("Escape."),void e._push(f)._changeState(vt)):g-s==0&&f===h[s]&&e._scan(h,s)?u?(lt("Quote."),void e._push(f)._changeState(kt)):void e._push(f):!1===p&&f===h[s]&&e._scan(h,s)?u&&e._isWhitespace(0,e._cursor-s)?(lt("Quote."),void e._push(f)._changeState(kt)):void e._push(f):f===a[t]&&e._scan(a,t)?(lt("Delimiter."),void e._push(f)._changeState(wt)):f===_[i]&&e._scan(_,i)?(lt("Newline."),void e._rewind(i)._changeState(ft)):void e._push(f)}},skipped_comment:function(e){var t,i;return t=e._newlineLastIndex,i=e._newline,function(n){if(bt("Char: %s",n),n===i[t]&&e._scan(i,t))return bt("Newline."),void e._rewind(t)._changeState(yt);e._push(n)}},skipped_escape:function(e){var t,i,n,r,s,o,a,_,c,u,d;return t=e._delimiterLastIndex,o=e._delimiter,i=e._newlineLastIndex,a=e._newline,n=e._commentLastIndex,_=e._comment,s=e._skipLastIndex,u=e._skip,r=e._escapeLastIndex,c=e._escape,d=Ve(Ve(t,i),r),function(p){var h=e._cursor,l=e._eidx,f=h-l;return St("Char: %s",p),f===t&&p===o[t]&&e._scan(o,t)?(St("Delimiter."),void e._push(p)._changeState(xt)):f===i&&p===a[i]&&e._scan(a,i)?(St("Newline."),void e._push(p)._changeState(xt)):f===r&&p===c[r]&&e._scan(c,r)?(St("Escape."),void e._push(p)._changeState(xt)):_&&h-n==0&&p===_[n]&&e._scan(_,n)?(St("Comment."),void e._push(p)._changeState(xt)):u&&h-s==0&&p===u[s]&&e._scan(u,s)?(St("Skip."),void e._push(p)._changeState(xt)):f>=d?(St("Normal character sequence."),void e._push(p)._changeState(xt)):void e._push(p)}},skipped_field:function(e){var t,i,n,r,s,o,a,_,c,u;return n=e._escapeLastIndex,_=e._escape,r=e._quoteLastIndex,u=e._quote,t=e._delimiterLastIndex,s=e._delimiter,i=e._newlineLastIndex,o=e._newline,a=e._quoting,c=e._strict,function(d){var p=e._cursor-e._cidx+1;return qt("Char: %s",d),d===_[n]&&e._scan(_,n)?(qt("Escape."),void e._push(d)._changeState(Et)):p-r==0&&d===u[r]&&e._scan(u,r)?(e._push(d),a?(qt("Quote."),void e._changeState(Ct)):void 0):!1===c&&d===u[r]&&e._scan(u,r)?(e._push(d),a&&e._isWhitespace(e._cidx,e._cursor-r)?(qt("Quote."),void e._changeState(Ct)):void 0):d===s[t]&&e._scan(s,t)?(qt("Delimiter."),void e._push(d)._changeState(It)):d===o[i]&&e._scan(o,i)?(qt("Newline."),void e._rewind(i)._changeState(Lt)):void e._push(d)}},skipped_invalid_quote_end:function(e){var t,i,n,r;return t=e._delimiterLastIndex,n=e._delimiter,i=e._newlineLastIndex,r=e._newline,function(s){return Rt("Char: %s",s),s===n[t]&&e._scan(n,t)?(Rt("Delimiter."),void e._push(s)._changeState(jt)):s===r[i]&&e._scan(r,i)?(Rt("Newline."),void e._rewind(i)._changeState(Ot)):void e._push(s)}},skipped_quote_end:function(e){var t,i,n,r,s,o,a,_;return t=e._delimiterLastIndex,s=e._delimiter,i=e._newlineLastIndex,o=e._newline,n=e._quoteLastIndex,a=e._quote,r=e._doublequote,_=Ve(Ve(t,i),n),function(c){return Wt("Char: %s",c),r&&c===a[n]&&e._scan(a,n)?(Wt("Double quote."),void e._push(c)._changeState(Pt)):c===s[t]&&e._scan(s,t)?(Wt("Delimiter."),void e._push(c)._changeState(Vt)):c===o[i]&&e._scan(o,i)?(Wt("Newline."),void e._rewind(i)._changeState(Nt)):e._cursor-e._qidx>=_?(Wt("Invalid closing quote."),void e._push(c)._changeState(At)):void e._push(c)}},skipped_quoted_escape:function(e){var t,i;return t=e._quoteLastIndex,i=e._quote,function(n){var r=e._cursor,s=e._eidx,o=r-s;return Dt("Char: %s",n),o===t&&n===i[t]&&e._scan(i,t)?(Dt("Quote."),void e._push(n)._changeState(Ft)):o>=t?(Dt("Escape sequence is not followed by a quote sequence."),void e._push(n)._changeState(Ft)):void e._push(n)}},skipped_quoted_field:function(e){var t,i,n,r,s;return t=e._escapeLastIndex,r=e._escape,i=e._quoteLastIndex,s=e._quote,n=e._doublequote,function(o){return Tt("Char: %s",o),!1===n&&o===r[t]&&e._scan(r,t)?(Tt("Escape."),void e._push(o)._changeState(Bt)):o===s[i]&&e._scan(s,i)?(Tt("Quote."),void e._push(o)._changeState(Qt)):void e._push(o)}}};function $t(e){var t,i;for(t=[],i=0;i<Ce.length;i++)t.push(Gt[Ce[i]](e));return t}var Ut,Zt=G("parser"),zt=Re.closed,Mt=Re.comment,Xt=Re.error,Ht=Re.escape,Jt=Re.field,Kt=Re.init,Yt=Re.invalid_quote_end,ei=Re.quote_end,ti=Re.quoted_escape,ii=Re.quoted_field,ni=Re.skip;function ri(e){var t,i;for(t="(?:",i=0;i<e.length-1;i++)t+=xe(e[i])+"|";return t+xe(e[i])+")"}function si(e){var t;return this instanceof si?(e=e||{},t=Ie(),this._buffer=[],this._cursor=-1,this._cidx=0,this._qidx=-1,this._eidx=-1,this._rowBufferFLG=ue(e.rowBuffer),this._rowBuffer=e.rowBuffer||t.rowBuffer,this._col=0,this._row=0,this._line=0,this._commented=!1,this._skipped=!1,this._errname="",this._comment=e.comment||t.comment,this._delimiter=e.delimiter||t.delimiter,this._doublequote=void 0===e.doublequote?t.doublequote:e.doublequote,this._escape=e.escape||t.escape,this._ltrim=void 0===e.ltrim?t.ltrim:e.ltrim,this._maxRows=void 0===e.maxRows?t.maxRows:e.maxRows,this._newline=e.newline||t.newline,this._quote=e.quote||t.quote,this._quoting=void 0===e.quoting?t.quoting:e.quoting,this._rtrim=void 0===e.rtrim?t.rtrim:e.rtrim,this._skip=e.skip||t.skip,this._skipBlankRows=void 0===e.skipBlankRows?t.skipBlankRows:e.skipBlankRows,this._skipRow=e.skipRow||t.skipRow,this._strict=void 0===e.strict?t.strict:e.strict,this._trimComment=void 0===e.trimComment?t.trimComment:e.trimComment,this._whitespace=ri(e.whitespace||t.whitespace),this._reWhitespace=new RegExp("^"+this._whitespace+"*([\\S\\s]*?)"+this._whitespace+"*$"),this._reWhitespaceLeft=new RegExp("^"+this._whitespace+"*"),this._reWhitespaceRight=new RegExp(this._whitespace+"*$"),this._onClose=e.onClose||t.onClose,this._onColumn=e.onColumn||t.onColumn,this._onComment=e.onComment||t.onComment,this._onRow=e.onRow||t.onRow,this._onSkip=e.onSkip||t.onSkip,this._onError=e.onError||t.onError,this._onWarn=e.onWarn||t.onWarn,this._commentLength=this._comment.length,this._commentLastIndex=this._commentLength-1,this._delimiterLength=this._delimiter.length,this._delimiterLastIndex=this._delimiterLength-1,this._escapeLength=this._escape.length,this._escapeLastIndex=this._escapeLength-1,this._newlineLength=this._newline.length,this._newlineLastIndex=this._newlineLength-1,this._quoteLength=this._quote.length,this._quoteLastIndex=this._quoteLength-1,this._skipLength=this._skip.length,this._skipLastIndex=this._skipLength-1,this._skipRow&&this._skipRow(0,0)?(this._state=ni,this._skipped=!0):this._state=Kt,this._states=$t(this),this):arguments.length?new si(e):new si}Re.skipped_comment,Re.skipped_escape,Re.skipped_field,Re.skipped_invalid_quote_end,Re.skipped_quote_end,Re.skipped_quoted_escape,Re.skipped_quoted_field,Y(si.prototype,"_push",(function(e){var t=this._buffer;return this._cursor+=1,this._cursor>=t.length?(t.push(e),Zt("Internal buffer size increased. Length: %d.",t.length)):t[this._cursor]=e,Zt("Cursor: %d. Push: %s",this._cursor,e),this})),Y(si.prototype,"_rewind",(function(e){return this._cursor-=e,Zt("Rewind: %d. Cursor: %d.",e,this._cursor),this})),Y(si.prototype,"_copyWithin",(function(e,t,i){var n,r;for(n=this._buffer,r=0;r<i;r++)n[e+r]=n[t+r];return this})),Y(si.prototype,"_slice",(function(e,t){return this._buffer.slice(e,t+1).join("")})),Y(si.prototype,"_isWhitespace",(function(e,t){return""===qe(this._slice(e,t),this._reWhitespaceLeft,"")})),Y(si.prototype,"_reset",(function(){return this._col=0,this._cidx=0,this._qidx=-1,this._eidx=-1,this._skipRow&&this._skipRow(this._row,this._line)?(this._state=ni,this._skipped=!0):(this._state=Kt,this._skipped=!1),this._commented=!1,this._cursor=-1,Zt("Parser reset."),this})),Y(si.prototype,"_setField",(function(e,t){var i=this._rowBuffer;return t>=i.length?(i.push(e),Zt("Row buffer size increased. Length: %d.",i.length)):i[t]=e,this})),Y(si.prototype,"_getField",(function(e,t){var i=this._slice(e,t);return this._ltrim?this._rtrim?qe(i,this._reWhitespace,"$1"):qe(i,this._reWhitespaceLeft,""):this._rtrim?qe(i,this._reWhitespaceRight,""):i})),Y(si.prototype,"_getRow",(function(){return this._rowBufferFLG?this._rowBuffer:this._rowBuffer.slice(0,this._col)})),Y(si.prototype,"_scan",(function(e,t){var i,n,r;for(i=this._buffer,n=this._cursor-t+1,r=0;r<t&&i[n+r]===e[r];r++);return r===t})),Y(si.prototype,"_onField",(function(){var e=this._getField(this._cidx,this._cursor);return this._setField(e,this._col),this._onColumn(e,this._row,this._col,this._line),Zt("Field. Line: %d. Row: %d. Column: %d. Value: %s",this._line,this._row,this._col,e),this._col+=1,this._cidx=this._cursor+1,this._qidx=-1,this._eidx=-1,this})),Y(si.prototype,"_onRecord",(function(){var e;return e=this._getField(this._cidx,this._cursor),!this._skipBlankRows||0!==this._col||""!==e&&""!==qe(e,this._reWhitespaceLeft,"")?(this._setField(e,this._col),this._onColumn(e,this._row,this._col,this._line),this._col+=1,this._onRow(this._getRow(),this._row,this._col,this._line),Zt("Record. Line: %d. Fields: %d.",this._line,this._col),this._row+=1,this._line+=1,this._reset(),this._row>=this._maxRows&&this._changeState(zt),this):this._onSkippedRow()})),Y(si.prototype,"_onCommentedRow",(function(){var e;return this._onComment?(e=this._slice(0,this._cursor),this._trimComment&&(e=qe(e,this._reWhitespaceLeft,"")),this._onComment(e,this._line),Zt("Comment. Line: %d. Value: %s",this._line,e)):Zt("Comment. Line: %d.",this._line),this._line+=1,this._reset(),this})),Y(si.prototype,"_onSkippedRow",(function(){var e;return this._onSkip?(e=this._slice(0,this._cursor),this._onSkip(e,this._line),Zt("Skipped row. Line: %d. Value: %s",this._line,e)):Zt("Skipped row. Line: %d.",this._line),this._line+=1,this._reset(),this})),Y(si.prototype,"_onClosingQuote",(function(){return this._qidx=this._cursor,this})),Y(si.prototype,"_onEscape",(function(){return this._eidx=this._cursor,this})),Y(si.prototype,"_createException",(function(e){var t;switch(e){case"INVALID_CLOSING_QUOTE":t=new Error(O("unexpected error. Encountered an invalid record. Field %d on line %d contains a closing quote which is not immediately followed by a delimiter or newline.",this._col,this._line));break;case"INVALID_OPENING_QUOTE":t=new Error(O("unexpected error. Encountered an invalid record. Field %d on line %d contains an opening quote which does not immediately follow a delimiter or newline.",this._col,this._line));break;case"INVALID_ESCAPE":t=new Error(O("unexpected error. Encountered an invalid record. Field %d on line %d contains an escape sequence which is not immediately followed by a special character sequence.",this._col,this._line));break;case"INVALID_QUOTED_ESCAPE":t=new Error(O("unexpected error. Encountered an invalid record. Field %d on line %d contains an escape sequence within a quoted field which is not immediately followed by a quote sequence.",this._col,this._line));break;case"CLOSED":t=new Error("invalid operation. Parser is unable to parse new chunks, as the parser has been closed. To parse new chunks, create a new parser instance.");break;default:t=new Error("invalid operation. Parser is in an unrecoverable error state. To parse new chunks, create a new parser instance.")}return t})),Y(si.prototype,"_raiseWarning",(function(e){var t;return this._onWarn&&(t=this._createException(e),Zt("Warning: %s",t.message),this._onWarn(t)),this})),Y(si.prototype,"_raiseException",(function(){var e=this._createException(this._errname);return Zt("Error: %s",e.message),this._onError(e),this})),Y(si.prototype,"_changeState",(function(e){switch(Zt("State transition: %s -> %s.",Ce[this._state],Ce[e]),e){case zt:this._close();break;case Mt:this._commented=!0;break;case Xt:this._raiseException();break;case Ht:this._onEscape();break;case Jt:this._state!==Ht&&this._onField();break;case Kt:this._commented?this._onCommentedRow():this._skipped?this._onSkippedRow():this._onRecord();break;case Yt:break;case ei:this._onClosingQuote();break;case ti:this._onEscape();break;case ii:break;case ni:this._skipped=!0}return this._state=e,this})),Y(si.prototype,"_setErrorState",(function(e){return e?Zt("Error: %s.",e):Zt("Reset error state."),this._errname=e,this})),Y(si.prototype,"_close",(function(){var e,t;return this.done?(this._setErrorState(zt)._changeState(Xt),this):(this._cursor>=0?(e=this._state)===Kt||e===Jt||e===ei?this._changeState(Kt)._onClose():(this._col&&this._onRow(this._getRow(),this._row,this._col),t=this._slice(this._cidx,this._cursor),Zt("Flush: %s",t),this._onClose(t)):this._onClose(),Zt("Closed."),this)})),Y(si.prototype,"next",(function(e){var t,i;if(Zt("Chunk: %s",e),this.done)return this._setErrorState(zt)._changeState(Xt),this;for(t=this._states,i=0;i<e.length;i++)if(t[this._state](e[i]),this._state===zt||this._state===Xt)return this;return this})),Y(si.prototype,"close",(function(){return this.done||this._changeState(zt),this})),Ut=si.prototype,ce(Ut,"done",{configurable:!1,enumerable:!1,get:function(){return this._state===zt||this._state===Xt}});var oi={};return function(e,t,i){T(e,t,{configurable:!1,enumerable:!0,writable:!1,value:i})}(oi,"parse",si),oi},"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).base=t();
//# sourceMappingURL=index.js.map
